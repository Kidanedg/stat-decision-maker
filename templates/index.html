<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Statistical Decision Maker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { display: flex; gap: 40px; }
        .column { flex: 1; }
        select, input[type="file"], input[type="submit"] {
            width: 100%; padding: 6px; margin-top: 10px;
        }
        h2, h3, h4 { margin-bottom: 5px; }
        .file-list { margin-top: 20px; }
        .file-list li { margin-bottom: 5px; }
        .error { color: red; }
    </style>
</head>
<body>

    <h2>üìä Statistical Decision Maker</h2>
    <form method="POST" enctype="multipart/form-data">
        <div class="container">

            <!-- üìÅ Upload and Method -->
            <div class="column">
                <h3>Upload CSV File(s):</h3>
                <input type="file" name="file" multiple required>

                {% if columns %}
                    <h3>Choose Analysis Method:</h3>
                    <select name="method" required>
                        <option value="">-- Select Method --</option>
                        <option value="t-test" title="Compare means of two groups">Two-Sample t-Test</option>
                        <option value="anova" title="Compare means of 3+ groups">ANOVA</option>
                        <option value="regression" title="Predict one variable from another">Linear Regression</option>
                        <option value="correlation" title="Measure linear relationship">Correlation</option>
                        <option value="chi-square" title="Check association between categories">Chi-Square</option>
                        <option value="timeseries" title="Visualize a time series column">Time Series</option>
                    </select>

                    <h3>Select Column 1:</h3>
                    <select name="col1" required>
                        {% for col in columns %}
                            <option value="{{ col }}">{{ col }}</option>
                        {% endfor %}
                    </select>

                    <h3>Select Column 2 (if needed):</h3>
                    <select name="col2">
                        <option value="">-- None --</option>
                        {% for col in columns %}
                            <option value="{{ col }}">{{ col }}</option>
                        {% endfor %}
                    </select>
                {% endif %}

                <br><br>
                <input type="submit" value="üîç Analyze">
            </div>

            <!-- üìà Results -->
            <div class="column">
                {% if result %}
                    <h3>üîé Analysis Result</h3>
                    {% if result.error %}
                        <p class="error">‚ùå {{ result.error }}</p>
                    {% else %}
                        <p><strong>{{ result.test }}</strong></p>
                        {% if result.statistic is defined %}
                            <p>Statistic: {{ result.statistic }}</p>
                            <p>p-Value: {{ result.p_value }}</p>
                            <p><strong>Decision:</strong> {{ result.decision }}</p>
                        {% endif %}
                        {% if result.plot %}
                            <h4>Plot:</h4>
                            <img src="{{ url_for('static', filename=result.plot) }}" width="500">
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
        </div>

        <!-- üìÅ Uploaded File List -->
        {% if uploaded_files %}
            <div class="file-list">
                <h4>üìÇ Uploaded Files</h4>
                <ul>
                    {% for f in uploaded_files %}
                        <li>
                            {{ f }}
                            <a href="{{ url_for('download_file', filename=f) }}" target="_blank">üì• Download</a>
                            <a href="{{ url_for('delete_file', filename=f) }}">üóëÔ∏è Delete</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </form>

</body>
</html>
