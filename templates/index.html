<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Statistical Decision Maker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        .navbar {
            background-color: #f2f2f2;
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            font-weight: bold;
        }
        .navbar a {
            text-decoration: none;
            color: #333;
        }
        .container { display: flex; gap: 40px; }
        .column { flex: 1; }
        select, input[type="file"], input[type="submit"], textarea {
            width: 100%; padding: 6px; margin-top: 10px;
            box-sizing: border-box;
            font-size: 14px;
        }
        textarea {
            height: 150px;
            font-family: monospace;
        }
        h2, h3, h4 { margin-bottom: 5px; }
        .file-list { margin-top: 20px; }
        .file-list li { margin-bottom: 5px; }
        .error { color: red; }
        a.delete-link {
            margin-left: 10px;
            color: red;
            font-weight: bold;
            text-decoration: none;
        }
        a.download-link {
            margin-left: 10px;
            color: green;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <!-- SPSS-like menu navigation -->
    <div class="navbar">
        <a href="/">üìÅ File</a>
        <a href="#analyze">üìä Analyze</a>
        <a href="#manual">‚úçÔ∏è Manual Entry</a>
    </div>

    <h2>üìä Statistical Decision Maker</h2>
    <form method="POST" enctype="multipart/form-data">

        <div class="container">

            <!-- Left column: upload + method + manual data -->
            <div class="column">

                <h3>Upload CSV File(s):</h3>
                <input type="file" name="file" multiple>

                {% if columns %}
                    <h3 id="analyze">Choose Analysis Method:</h3>
                    <select name="method" required>
                        <option value="">-- Select Method --</option>
                        <option value="t-test" title="Compare means of two groups">Two-Sample t-Test</option>
                        <option value="anova" title="Compare means of 3+ groups">ANOVA</option>
                        <option value="regression" title="Predict one variable from another">Linear Regression</option>
                        <option value="correlation" title="Measure linear relationship">Correlation</option>
                        <option value="chi-square" title="Check association between categories">Chi-Square</option>
                        <option value="timeseries" title="Visualize a time series column">Time Series</option>
                    </select>

                    <h3>Select Column 1:</h3>
                    <select name="col1" required>
                        {% for col in columns %}
                            <option value="{{ col }}">{{ col }}</option>
                        {% endfor %}
                    </select>

                    <h3>Select Column 2 (if needed):</h3>
                    <select name="col2">
                        <option value="">-- None --</option>
                        {% for col in columns %}
                            <option value="{{ col }}">{{ col }}</option>
                        {% endfor %}
                    </select>
                {% endif %}

                <br><br>
                <input type="submit" value="üîç Analyze">

                <hr>

                <h3 id="manual">‚úçÔ∏è Or Enter Data Manually (CSV format)</h3>
                <textarea name="manual_data" placeholder="group,value&#10;A,5.1&#10;A,4.8&#10;B,6.2&#10;B,5.9"></textarea>
                <p style="font-size: small; color: gray;">
                    Enter data as CSV text: column headers separated by commas, one row per line.<br>
                    Example:<br>
                    group,value<br>
                    A,5.1<br>
                    A,4.8<br>
                    B,6.2<br>
                    B,5.9
                </p>

            </div>

            <!-- Right column: results -->
            <div class="column">
                {% if result %}
                    <h3>üîé Analysis Result</h3>
                    {% if result.error %}
                        <p class="error">‚ùå {{ result.error }}</p>
                    {% else %}
                        <p><strong>{{ result.test }}</strong></p>
                        {% if result.statistic is defined %}
                            <p>Statistic: {{ result.statistic }}</p>
                            <p>p-Value: {{ result.p_value }}</p>
                            <p><strong>Decision:</strong> {{ result.decision }}</p>
                        {% endif %}
                        {% if result.plot %}
                            <h4>Plot:</h4>
                            <img src="{{ url_for('static', filename=result.plot) }}" width="500" alt="Plot image">
                        {% endif %}
                    {% endif %}
                {% else %}
                    <p>No results yet. Upload a file or enter data to start analysis.</p>
                {% endif %}

                <!-- Uploaded files list -->
                <div class="file-list">
                    <h4>Uploaded Files</h4>
                    <ul>
                        {% for f in uploaded_files %}
                            <li>
                                {{ f }}
                                <a class="download-link" href="{{ url_for('download_file', filename=f) }}">[Download]</a>
                                <a class="delete-link" href="{{ url_for('delete_file', filename=f) }}" onclick="return confirm('Delete {{ f }}?')">[Delete]</a>
                            </li>
                        {% else %}
                            <li>No uploaded files.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

        </div>

    </form>

</body>
</html>
